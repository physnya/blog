import{_ as p,c as r,b as e,a as l,d as i,e as n,w as t,r as d,o}from"./app-CdLgCJ_b.js";const h={};function k(m,s){const a=d("VPLink");return o(),r("div",null,[s[15]||(s[15]=e("p",null,"最近站点整体经历了一次完全的重构，系统从 Hexo 切换到 VuePress，所以写一些在重构过程中踩到的坑作为记录.",-1)),s[16]||(s[16]=e("p",null,"(顺便就当是流水账，作为每周例行的更新了)",-1)),s[17]||(s[17]=e("h2",{id:"笔记目录配置",tabindex:"-1"},[e("a",{class:"header-anchor",href:"#笔记目录配置"},[e("span",null,"笔记目录配置")])],-1)),e("p",null,[s[1]||(s[1]=i("之前应该也在 ",-1)),n(a,{href:"/posts/fz8kwh0a/#fragment-2-vuepress-%E5%88%9D%E4%BD%93%E9%AA%8C"},{default:t(()=>[...s[0]||(s[0]=[i("流水账 Week 16",-1)])]),_:1}),s[2]||(s[2]=i(" 里面提到过这件事情. 当时想做的其实是一个单纯的笔记页面，但是后来一想觉得既然笔记页面已经用上了 VuePress，干脆把所有的页面全部重构一次，否则只有一个页面进行过改造显得有点不统一；再者，因为笔记页面分离，造成的 RSS 变化、字数统计处理等等都会和以前不一样，要改还不如全部推倒重来.",-1))]),s[18]||(s[18]=e("p",null,[i("这里笔记目录的配置问题简而言之是插件生成 "),e("code",null,"permalink"),i(" 的时间应该晚于配置文件 ("),e("code",null,"config.ts"),i(" 等) 的配置时间，否则目录中生成的链接会出现错误，进而导致目录直接不显示.")],-1)),e("p",null,[s[4]||(s[4]=i("VuePress 主题 Plume 自带永久链接生成插件，在运行 ",-1)),s[5]||(s[5]=e("code",null,"npm run docs:dev",-1)),s[6]||(s[6]=i(" 或者 ",-1)),s[7]||(s[7]=e("code",null,"npm run docs:build",-1)),s[8]||(s[8]=i(" 时，会为还没有生成链接的文章生成一个八位乱码的链接，比如 ",-1)),n(a,{href:"/posts/bnw31l0t/"},{default:t(()=>[...s[3]||(s[3]=[i("资源收集（持续更新）",-1)])]),_:1}),s[9]||(s[9]=i("对应的链接是 ",-1)),s[10]||(s[10]=e("code",null,"/posts/bnw31l0t/",-1)),s[11]||(s[11]=i(".",-1))]),s[19]||(s[19]=l('<blockquote><p>事实上我一开始以为是生成和文件名有一定关系的链接，但是后续已经生成之后我不好再改动，因为 twikoo 评论和链接有比较大的关系，如果要改动就要备份数据再来改动 <code>twikoo-comment.json</code>，又是一个体力活.</p></blockquote><p>与目录有关联的配置文件应该在 <code>.vuepress/notes/*</code> 路径下，再统一引入到 <code>notes/*</code> 目录下的 <code>index.ts</code>，最后引入到总的配置文件 <code>config.ts</code> 中. 笔记的配置文件内部要求编写目录的顺序等，在这里可以使用文件的相对路径或是链接，但是一旦生成链接，缓存中已经生成过一次的目录就可能不再适用，导致问题出现.</p><h2 id="rss-生成" tabindex="-1"><a class="header-anchor" href="#rss-生成"><span>RSS 生成</span></a></h2><p>因为在 <a href="https://follow.is" target="_blank" rel="noopener noreferrer">follow</a> 上有一些关注者，所以还是希望保留原有的 RSS 链接 (<code>atom.xml</code>).</p>',4)),e("p",null,[s[13]||(s[13]=i("(实际上我也不知道为什么在 follow 上会有这么多人看我的灌水文章，比如下面这个 ",-1)),n(a,{href:"/post/a8n8h73w/"},{default:t(()=>[...s[12]||(s[12]=[i("流水账 Week 15",-1)])]),_:1}),s[14]||(s[14]=i(" 的阅读量就挺吓人的，至少我认识的网友里面没见过这么高阅读量)",-1))]),s[20]||(s[20]=l(`<div style="text-align:center;"><img src="https://vip.123pan.cn/1845440081/ymjew503t0n000d7w32y4yo8gtw0a8cqDIYxAIFxDda1DGxPDwUzAa==.png" style="zoom:80%;"></div><p>看了一下 <a href="https://ecosystem.vuejs.press/zh/" target="_blank" rel="noopener noreferrer">VuePress 生态系统</a>，似乎有一个 feed 插件，但是下载之后想把设置放在 <code>config.ts</code> 的尝试一直失败，VScode 里面的红色波浪线不见消散的迹象. 后来找到原因，是 theme-plume 的配置文件中有如下写法：</p><div class="language-typescript line-numbers-mode" data-highlighter="shiki" data-ext="typescript" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-typescript"><span class="line"><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;">export</span><span style="--shiki-light:#1E754F;--shiki-dark:#4D9375;"> default</span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;"> defineUserConfig</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">({</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">    theme</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">: </span><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">plumeTheme</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">({</span></span>
<span class="line"><span style="--shiki-light:#998418;--shiki-dark:#B8A965;">        plugins</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">: {</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">            /*plume 主题内置插件配置*/</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">        }</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    })</span></span>
<span class="line"><span style="--shiki-light:#B07D48;--shiki-dark:#BD976A;">    plugins</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">: [</span></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">    	pluginName</span><span style="--shiki-light:#999999;--shiki-dark:#666666;">({</span></span>
<span class="line"><span style="--shiki-light:#A0ADA0;--shiki-dark:#758575DD;">    		/*VuePress 其他插件的配置*/</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">		})</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">    ]</span></span>
<span class="line"><span style="--shiki-light:#999999;--shiki-dark:#666666;">})</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>这两个位置不一样……</p><p>好罢，这个错误疑似有点太蠢了，或许写在这里也只能提醒提醒我自己.</p><p>不过即使已经正确生成了 <code>atom.xml</code>，follow 那边依然显示订阅源失效，而且两条报错信息来回换：</p><div class="language-bash line-numbers-mode" data-highlighter="shiki" data-ext="bash" style="--shiki-light:#393a34;--shiki-dark:#dbd7caee;--shiki-light-bg:#ffffff;--shiki-dark-bg:#121212;"><pre class="shiki shiki-themes vitesse-light vitesse-dark vp-code"><code class="language-bash"><span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">update</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> or</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> delete</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> on</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> table</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">entries</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> violates</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> foreign</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> key</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> constraint</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">transactions_to_entry_id_entries_id_fk</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> on</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> table</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;"> &quot;</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;">transactions</span><span style="--shiki-light:#B5695977;--shiki-dark:#C98A7D77;">&quot;</span></span>
<span class="line"></span>
<span class="line"><span style="--shiki-light:#59873A;--shiki-dark:#80A665;">cannot</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> read</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> properties</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> of</span><span style="--shiki-light:#B56959;--shiki-dark:#C98A7D;"> undefined</span></span></code></pre><div class="line-numbers" aria-hidden="true" style="counter-reset:line-number 0;"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>后面那条应该是说我的 <code>xml</code> 文件格式有点问题，但是第一条是完全看不懂，在 follow 官方的 discord 群里面提问也一直没人回应 (这也不能全怪他们，我看群里面报错的太多了 ╯︿╰) 在 inoreader 等地测试的结果是正确的，所以我现在也合理怀疑缓存原因，毕竟 follow 那边使用服务器定时获取源的信息.</p><p>等找到原因我再花一点时间修复这个问题吧.</p><h2 id="twikoo-评论迁移" tabindex="-1"><a class="header-anchor" href="#twikoo-评论迁移"><span>twikoo 评论迁移</span></a></h2><p>可能是最麻烦的一件事，没有之一. 因为我的文件结构变化，所有链接都有改动，导出的评论数据不能直接导入，要先在本地把链接全部修改之后再导入云端 —— 而且要把原先的数据删掉.</p><p>因为我不会给 MongoDB 直接发指令，所以还是手动删除数据库里面的数据，想起来还是很累……</p><h2 id="umami-配置-——-免费手段" tabindex="-1"><a class="header-anchor" href="#umami-配置-——-免费手段"><span>Umami 配置 —— 免费手段</span></a></h2><p>前几天看了一下 Google Analytics，觉得如果每次看统计数据都要科学上网还是很难受. 心心念念 Umami 半年多了，可惜自己一直没钱买服务器，就处于忍受 GA 的状态.</p><p>有幸这回找到一种不使用自己的服务器部署 Umami 的方式，后端数据库使用 <a href="https://supabase.com/" target="_blank" rel="noopener noreferrer">supabase</a>，目前用下来体验不差. 只是 Vercel 在国内即使配置自己的二级域名还是访问比较慢.</p><p>因为 VuePress 插件 <a href="https://ecosystem.vuejs.press/zh/plugins/development/active-header-links.html" target="_blank" rel="noopener noreferrer">@vuepress/plugin-active-header-links@next</a> 的原因，我站点的所有 h2 标题都被改写成链接，同时启动了滚动事件监听，当页面滚动至某个 <em>标题锚点</em> 后，如果存在对应的 <em>标题链接</em> ，那么该插件会将路由 Hash 更改为该 <em>标题锚点</em>. 这导致我站 View 数大量偏高，在部署完成的一周之内，View 数达到了惊人的 3k：</p><div class="demo-wrapper only-img"><div class="demo-head"><div class="demo-ctrl"><i></i><i></i><i></i></div></div><div class="demo-container"><img src="https://vip.123pan.cn/1845440081/ymjew503t0n000d7w32y4yobcmw0gdzsDIYxAIFxDda1DGxPDwUzAa==.png" style="zoom:60%;"></div></div><p>但是相对于 GA 而言，Umami 的 js 在国内访问时至少保证能加载出来，避免 GA 大量遗漏计数的情况.</p>`,18))])}const u=p(h,[["render",k]]),y=JSON.parse('{"path":"/posts/rebulid/","title":"重构笔记","lang":"zh-CN","frontmatter":{"changelog":false,"title":"重构笔记","permalink":"/posts/rebulid/","createTime":"2025/2/23 08:08:17","tags":["blog"],"description":"最近站点整体经历了一次完全的重构，系统从 Hexo 切换到 VuePress，所以写一些在重构过程中踩到的坑作为记录. (顺便就当是流水账，作为每周例行的更新了) 笔记目录配置 之前应该也在 里面提到过这件事情. 当时想做的其实是一个单纯的笔记页面，但是后来一想觉得既然笔记页面已经用上了 VuePress，干脆把所有的页面全部重构一次，否则只有一个页面...","head":[["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"重构笔记\\",\\"image\\":[\\"\\"],\\"dateModified\\":\\"2025-10-09T02:50:46.000Z\\",\\"author\\":[]}"],["meta",{"property":"og:url","content":"https://physnya.top/posts/rebulid/"}],["meta",{"property":"og:site_name","content":"菲兹克斯喵"}],["meta",{"property":"og:title","content":"重构笔记"}],["meta",{"property":"og:description","content":"最近站点整体经历了一次完全的重构，系统从 Hexo 切换到 VuePress，所以写一些在重构过程中踩到的坑作为记录. (顺便就当是流水账，作为每周例行的更新了) 笔记目录配置 之前应该也在 里面提到过这件事情. 当时想做的其实是一个单纯的笔记页面，但是后来一想觉得既然笔记页面已经用上了 VuePress，干脆把所有的页面全部重构一次，否则只有一个页面..."}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2025-10-09T02:50:46.000Z"}],["meta",{"property":"article:tag","content":"blog"}],["meta",{"property":"article:modified_time","content":"2025-10-09T02:50:46.000Z"}]]},"readingTime":{"minutes":4.75,"words":1425},"git":{"createdTime":1740302585000,"updatedTime":1759978246000,"contributors":[{"name":"physnya","username":"physnya","email":"676266673@qq.com","commits":4,"avatar":"https://avatars.githubusercontent.com/physnya?v=4","url":"https://github.com/physnya"}]},"autoDesc":true,"filePathRelative":"blog/aboutMyBlog/rebuild.md","headers":[],"categoryList":[{"id":"bc1bb9","sort":10002,"name":"aboutMyBlog"}]}');export{u as comp,y as data};
